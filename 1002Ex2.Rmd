---
title: "Example2"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(gMCP)
graph <- BretzEtAl2011()
pvalues <- c(0.1, 0.008, 0.005, 0.15, 0.04, 0.006)
gMCP(graph, pvalues,alpha = 0.05)

# graphGUI(graph)
```
![Example1 GUI](./Ex2.png)



```{r}
source("./R/gMCP_xc2.R")
weights <- graph@weights
matrix <- graph@m
matrix <- round(matrix,digits = 2)
gMCP_xc2(matrix,weights, 
         pvalues, alpha = 0.05,fweights = F) 

```


```{r,message=FALSE}
library(network)
library(ggplot2)
library(ggnetwork)
```


```{r}
net <- network(matrix,directed = TRUE,
               names.eval = "weights",ignore.eval = FALSE)
net
```



```{r,echo=FALSE, fig.width = 4,fig.height = 4,fig.align="center"}
par(mar = c(4.5, 4.5, 1.5, 1.5))
mfrow=c(1,2)
#net %v% "family" <- sample(letters[1:3], 10, replace = TRUE)
#net %v% "importance" <- sample(1:3, 10, replace = TRUE)
net %v% "vertex.names"  <- rownames(matrix)
e <- network.edgecount(net)
#set.edge.attribute(net, "type", sample(letters[24:26], e, replace = TRUE))
#set.edge.attribute(net, "day", sample(1:3, e, replace = TRUE))

ggplot(net, aes(x = x, y = y, xend = xend, yend = yend)) +
  geom_edges(arrow = arrow(length = unit(10, "pt"), type = "closed"),
             color = "grey50",
             curvature = 0.25) +
  geom_nodes(aes(x, y),color = "grey", size = 8) +
  geom_nodetext(aes(label = vertex.names)) +
  geom_edgetext_repel(aes(label = weights), color = "white", fill = "grey25",
                      box.padding = unit(0.25, "line")) +
  scale_color_brewer(palette = "Set2") +
#  scale_size_area("importance", breaks = 1:3, max_size = 9) +
  theme_blank()
```

![Example1 GUI](./Ex2_2.png)
```{r}
res <- gMCP_xc2(matrix,weights, 
         pvalues, alpha = 0.05,fweights = F)
res
```


```{r}
res_pvalues <- res$pvalues
res_weights <- round(res$weights,digits = 2)
res_G <- round(res$G,digits = 2)

res_net <- network(res_G,directed = TRUE,
               names.eval = "weights",ignore.eval = FALSE)
res_net %v% "vertex.names"  <- rownames(matrix)

e <- network.edgecount(res_net)

# res_net %v% "weights" <- res$weights
 res_net %v% "Rejection" <- res$rejected
# res_net %v% "vertex.names"  <- rownames(matrix)
res_net

```


```{r, fig.width = 6,fig.height = 5,fig.align="center"}
#set.edge.attribute(res_net, "color", ifelse(res_net %e% "reject" == FALSE, "red", "grey75"))

# 
ggplot(res_net, aes(x = x, y = y, xend = xend, yend = yend)) +
  geom_edges(arrow = arrow(length = unit(15, "pt"), type = "closed"),
             color = "grey50",
             curvature = 0.15) +
  geom_nodes(aes(x, y,color = Rejection), size = 12) +
  geom_nodetext(aes(label = vertex.names)) +
  # geom_edgetext_repel(aes(label = weights), color = "white", fill = "grey25",
  #                     box.padding = unit(0.25, "line")) +
  scale_color_brewer(palette = "Set2") +
#  scale_size_area("importance", max_size = 9) +
  theme_blank()+
  theme(legend.position = "bottom")

```
